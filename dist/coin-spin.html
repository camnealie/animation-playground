<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loot — Coin Spin</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: transparent;
      overflow: hidden;
    }

    .scene {
      position: relative;
      width: 160px;
      height: 180px;
    }

    .coin-anchor {
      position: absolute;
      bottom: 30px;
      left: 50%;
      width: 0;
      height: 0;
      /* This anchor point lets us move y from the bottom */
    }

    .coin {
      position: absolute;
      width: 120px;
      height: 120px;
      left: -60px; /* center on anchor */
      bottom: 0;
      transform-style: preserve-3d;
      perspective: 600px;
    }

    .coin-face {
      width: 100%;
      height: 100%;
      image-rendering: pixelated;
      display: block;
      backface-visibility: hidden;
    }

    /* Golden glow behind the coin */
    .coin-glow {
      position: absolute;
      width: 120px;
      height: 120px;
      left: -60px;
      bottom: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255, 215, 0, 0.25) 0%, rgba(255, 180, 0, 0.08) 50%, transparent 70%);
      filter: blur(8px);
      opacity: 0;
      pointer-events: none;
    }

    /* Shadow on the ground */
    .shadow {
      position: absolute;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
      width: 90px;
      height: 18px;
      border-radius: 50%;
      background: radial-gradient(ellipse, rgba(0,0,0,0.35) 0%, transparent 70%);
      filter: blur(2px);
    }

    /* Sparkle particles */
    .sparkle {
      position: absolute;
      border-radius: 50%;
      opacity: 0;
      pointer-events: none;
    }

    .sparkle-gold {
      background: radial-gradient(circle, #ffe066, #ffd700);
      box-shadow: 0 0 4px rgba(255, 215, 0, 0.6);
    }

    .sparkle-white {
      background: radial-gradient(circle, #fff, #ffeebb);
      box-shadow: 0 0 3px rgba(255, 255, 255, 0.5);
    }
  </style>
</head>
<body>
  <div class="scene" id="scene">
    <div class="shadow" id="shadow"></div>
    <div class="coin-anchor" id="coinAnchor">
      <div class="coin-glow" id="glow"></div>
      <div class="coin" id="coin">
        <img class="coin-face" src="coin.png" alt="Loot coin" />
      </div>
    </div>
  </div>

  <script>
    const scene = document.getElementById('scene');
    const coinAnchor = document.getElementById('coinAnchor');
    const coin = document.getElementById('coin');
    const glow = document.getElementById('glow');
    const shadow = document.getElementById('shadow');
    let hasPlayed = false;

    // Create sparkle elements
    const sparkleCount = 10;
    const sparkles = [];
    for (let i = 0; i < sparkleCount; i++) {
      const sp = document.createElement('div');
      sp.className = 'sparkle ' + (i % 3 === 0 ? 'sparkle-white' : 'sparkle-gold');
      scene.appendChild(sp);
      sparkles.push(sp);
    }

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !hasPlayed) {
          hasPlayed = true;
          observer.disconnect();
          playEntrance();
        }
      });
    }, { threshold: 0.3 });

    observer.observe(scene);

    function playEntrance() {
      const tl = gsap.timeline({ delay: 0.15 });

      // Initial state: coin high above, invisible
      gsap.set(coinAnchor, { y: -120, opacity: 0 });
      gsap.set(shadow, { opacity: 0, scaleX: 0.4, scaleY: 0.4 });
      gsap.set(glow, { opacity: 0 });
      gsap.set(coin, { rotateY: 0, rotateZ: -8 });

      // ── Drop with slight rotation ──
      tl.to(coinAnchor, {
        y: 0,
        opacity: 1,
        duration: 0.45,
        ease: 'power3.in',
      });

      // Spin a bit while falling
      tl.to(coin, {
        rotateZ: 0,
        duration: 0.45,
        ease: 'power2.in',
      }, '<');

      // ── IMPACT: Squash on landing ──
      tl.to(coin, {
        scaleX: 1.15,
        scaleY: 0.88,
        duration: 0.06,
        ease: 'power2.out',
      });

      // Shadow slams in
      tl.to(shadow, {
        opacity: 1,
        scaleX: 1.1,
        scaleY: 1,
        duration: 0.06,
        ease: 'power2.out',
      }, '<');

      // Glow flash on impact
      tl.to(glow, {
        opacity: 0.8,
        duration: 0.08,
        ease: 'power2.out',
      }, '<');

      // Sparkle burst
      tl.add(() => burstSparkles(0.7));

      // ── Bounce 1: Stretch up ──
      tl.to(coin, {
        scaleX: 0.92,
        scaleY: 1.08,
        duration: 0.08,
        ease: 'power2.out',
      });
      tl.to(coinAnchor, {
        y: -28,
        duration: 0.28,
        ease: 'power2.out',
      });
      tl.to(shadow, {
        scaleX: 0.6,
        scaleY: 0.6,
        opacity: 0.4,
        duration: 0.28,
        ease: 'power2.out',
      }, '<');
      tl.to(glow, {
        opacity: 0.3,
        duration: 0.28,
        ease: 'power2.out',
      }, '<');

      // Normalize shape at apex
      tl.to(coin, {
        scaleX: 1,
        scaleY: 1,
        duration: 0.12,
        ease: 'sine.out',
      }, '-=0.12');

      // Fall back down
      tl.to(coinAnchor, {
        y: 0,
        duration: 0.22,
        ease: 'power2.in',
      });
      tl.to(shadow, {
        scaleX: 1,
        scaleY: 1,
        opacity: 1,
        duration: 0.22,
        ease: 'power2.in',
      }, '<');

      // Squash again on 2nd landing
      tl.to(coin, {
        scaleX: 1.08,
        scaleY: 0.93,
        duration: 0.05,
        ease: 'power2.out',
      });
      tl.to(glow, {
        opacity: 0.5,
        duration: 0.05,
      }, '<');

      // ── Bounce 2: Tiny ──
      tl.to(coin, {
        scaleX: 0.97,
        scaleY: 1.03,
        duration: 0.05,
        ease: 'power2.out',
      });
      tl.to(coinAnchor, {
        y: -8,
        duration: 0.15,
        ease: 'power2.out',
      });
      tl.to(shadow, {
        scaleX: 0.85,
        opacity: 0.7,
        duration: 0.15,
        ease: 'power2.out',
      }, '<');

      // Settle
      tl.to(coinAnchor, {
        y: 0,
        duration: 0.12,
        ease: 'power2.in',
      });
      tl.to(coin, {
        scaleX: 1,
        scaleY: 1,
        duration: 0.12,
        ease: 'power2.inOut',
      }, '<');
      tl.to(shadow, {
        scaleX: 1,
        scaleY: 1,
        opacity: 1,
        duration: 0.12,
        ease: 'power2.in',
      }, '<');

      // Glow settles to idle
      tl.to(glow, {
        opacity: 0.15,
        duration: 0.4,
        ease: 'power2.out',
      });

      // Small sparkle on final settle
      tl.add(() => burstSparkles(0.4), '-=0.1');

      // Start idle after a pause
      tl.add(() => startIdle(), '+=0.8');
    }

    function burstSparkles(intensity) {
      const count = Math.floor(sparkleCount * intensity);
      const centerX = 80; // center of scene
      const centerY = 120; // near coin bottom
      sparkles.forEach((sp, i) => {
        if (i >= count) return;
        const angle = (i / count) * Math.PI * 2 + (Math.random() - 0.5) * 0.5;
        const dist = 25 + Math.random() * 35;
        const size = 3 + Math.random() * 5;
        gsap.set(sp, {
          x: centerX,
          y: centerY - 50,
          width: size,
          height: size,
          opacity: 0.8 + Math.random() * 0.2,
          scale: 1,
        });
        gsap.to(sp, {
          x: centerX + Math.cos(angle) * dist,
          y: centerY - 50 + Math.sin(angle) * dist - 10,
          opacity: 0,
          scale: 0,
          duration: 0.4 + Math.random() * 0.4,
          ease: 'power2.out',
        });
      });
    }

    function startIdle() {
      // Breathing glow
      gsap.to(glow, {
        opacity: 0.25,
        duration: 2,
        ease: 'sine.inOut',
        yoyo: true,
        repeat: -1,
      });

      // Gentle idle hover
      gsap.to(coinAnchor, {
        y: -4,
        duration: 1.8,
        ease: 'sine.inOut',
        yoyo: true,
        repeat: -1,
      });
      gsap.to(shadow, {
        scaleX: 0.92,
        opacity: 0.85,
        duration: 1.8,
        ease: 'sine.inOut',
        yoyo: true,
        repeat: -1,
      });

      // Periodic arcade spin
      doArcadeSpin();
    }

    function doArcadeSpin() {
      // Random delay between spins: 3–5s
      const delay = 3 + Math.random() * 2;

      gsap.delayedCall(delay, () => {
        const spinTl = gsap.timeline({
          onComplete: doArcadeSpin, // loop
        });

        // Rise up
        spinTl.to(coinAnchor, {
          y: -22,
          duration: 0.35,
          ease: 'power2.out',
        });
        spinTl.to(shadow, {
          scaleX: 0.5,
          scaleY: 0.5,
          opacity: 0.3,
          duration: 0.35,
          ease: 'power2.out',
        }, '<');
        spinTl.to(glow, {
          opacity: 0.5,
          duration: 0.35,
          ease: 'power2.out',
        }, '<');

        // Stretch slightly as it rises
        spinTl.to(coin, {
          scaleY: 1.05,
          scaleX: 0.96,
          duration: 0.2,
          ease: 'power2.out',
        }, '<');

        // 3D spin using rotateY — 2 full rotations
        spinTl.to(coin, {
          rotateY: 720,
          duration: 0.7,
          ease: 'power1.inOut',
        });

        // While spinning, a slight wobble on Z
        spinTl.to(coin, {
          rotateZ: 5,
          duration: 0.175,
          ease: 'sine.inOut',
          yoyo: true,
          repeat: 3,
        }, '<');

        // Glow pulses during spin
        spinTl.to(glow, {
          opacity: 0.7,
          duration: 0.35,
          ease: 'sine.inOut',
          yoyo: true,
          repeat: 1,
        }, '<');

        // Fall back, normalize
        spinTl.to(coin, {
          scaleX: 1,
          scaleY: 1,
          rotateZ: 0,
          duration: 0.15,
          ease: 'power2.out',
        });
        spinTl.to(coinAnchor, {
          y: 0,
          duration: 0.3,
          ease: 'power3.in',
        });
        spinTl.to(shadow, {
          scaleX: 1,
          scaleY: 1,
          opacity: 1,
          duration: 0.3,
          ease: 'power3.in',
        }, '<');

        // Landing squash
        spinTl.to(coin, {
          scaleX: 1.1,
          scaleY: 0.9,
          duration: 0.05,
          ease: 'power2.out',
        });
        spinTl.to(glow, {
          opacity: 0.6,
          duration: 0.05,
        }, '<');

        // Sparkle on land
        spinTl.add(() => burstSparkles(0.5));

        // Recover
        spinTl.to(coin, {
          scaleX: 1,
          scaleY: 1,
          rotateY: 0, // reset for next spin
          duration: 0.2,
          ease: 'elastic.out(1, 0.5)',
        });
        spinTl.to(glow, {
          opacity: 0.15,
          duration: 0.3,
          ease: 'power2.out',
        }, '<');
      });
    }
  </script>
</body>
</html>
